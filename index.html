<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çŸ­é“¾ç”Ÿæˆå™¨</title>
<style>
  * { box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
  .container { max-width: 600px; margin: 0 auto; }
  h1 { text-align: center; color: white; margin-bottom: 2rem; font-size: 2.5rem; }
  .form-group { margin-bottom: 1.5rem; }
  label { display: block; margin-bottom: 0.5rem; color: white; font-weight: 500; }
  
  /* === è¾“å…¥æ¡†ä¿®å¤ï¼šé»˜è®¤é»‘è‰²æ–‡å­— === */
  input, select { 
    width: 100%; padding: 0.75rem; border: none; border-radius: 8px; 
    font-size: 1rem; color: black !important; background: white;
  }
  input::placeholder { color: #999 !important; }
  
  /* æ ‡ç­¾æ–‡å­—ä¿®å¤ */
  label[for="slug"], label[for="customMinutes"] { color: black !important; }
  
  .hidden-field { display: none; }
  .hidden-field.show { display: block; }
  /* ... å…¶ä»–æ ·å¼ä¿æŒä¸å˜ ... */
</style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”— çŸ­é“¾ç”Ÿæˆå™¨</h1>
    <form id="shortenerForm">
      <div class="form-group">
        <label for="url"style="color: black !important;"> ç›®æ ‡ URL</label>
        <input type="url" id="url" placeholder="https://example.com" required>
      </div>
      <div class="form-group">
        <label for="slug" style="color: black !important;">è‡ªå®šä¹‰çŸ­é“¾æ ‡è¯†</label>
        <input type="text" id="slug" placeholder="abcd(2-10ä½å­—ç¬¦)" maxlength="10">
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="enablePassword">
        <label for="enablePassword" style="margin:0; color:#333; font-weight:normal;">ğŸ”’ å¯†ç ä¿æŠ¤</label>
      </div>
      <div id="passwordField" class="form-group hidden-field">
        <label for="password">å¯†ç  (è‡³å°‘4ä½)</label>
        <input type="password" id="password" placeholder="è¾“å…¥å¯†ç ">
      </div>
      <div class="form-group">
        <label for="expireType"style="color: black !important;">â° è¿‡æœŸæ—¶é—´</label>
        <select id="expireType">
          <option value="never">æ°¸ä¸è¿‡æœŸ</option>
          <option value="hour">1å°æ—¶</option>
          <option value="day">1å¤©</option>
          <option value="week">1å‘¨</option>
          <option value="month">1ä¸ªæœˆ</option>
          <option value="custom">è‡ªå®šä¹‰æ—¶é—´</option>
        </select>
      </div>
      <div id="customExpireField" class="form-group hidden-field">
        <label for="customMinutes"style="color: black !important;">è‡ªå®šä¹‰åˆ†é’Ÿæ•°</label>
        <input type="number" id="customMinutes" placeholder="60åˆ†é’Ÿ" min="1">
      </div>
      <button type="submit">
        <span class="loading" id="loading">â³ ç”Ÿæˆä¸­...</span>
        <span id="submitText">ğŸš€ ç”ŸæˆçŸ­é“¾</span>
      </button>
    </form>
    <div id="alert" class="alert"></div>
  </div>

  <div class="result-modal" id="resultModal">
    <div>
      <div class="result-row">
        <span class="result-label">çŸ­é“¾æ¥</span>
        <span class="result-value" id="resultLink">-</span>
      </div>
      <div class="result-row">
        <span class="result-label">çŸ­é“¾æ ‡è¯†</span>
        <span class="result-value" id="resultSlug">-</span>
      </div>
      <div class="result-row">
        <span class="result-label">å¯†ç ä¿æŠ¤</span>
        <span class="result-value" id="resultPassword">-</span>
      </div>
      <div class="result-row">
        <span class="result-label">è¿‡æœŸæ—¶é—´ (ä¸­å›½æ—¶é—´)</span>
        <span class="result-value" id="resultExpire">-</span>
      </div>
      <button class="copy-btn" onclick="copyToClipboard(document.getElementById('resultLink').textContent)">ğŸ“‹ å¤åˆ¶çŸ­é“¾æ¥</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('shortenerForm');
    const passwordCheckbox = document.getElementById('enablePassword');
    const passwordField = document.getElementById('passwordField');
    const expireTypeSelect = document.getElementById('expireType');
    const customExpireField = document.getElementById('customExpireField');
    const alertDiv = document.getElementById('alert');
    const resultModal = document.getElementById('resultModal');

    passwordCheckbox.addEventListener('change', () => { passwordField.classList.toggle('show', passwordCheckbox.checked); });
    expireTypeSelect.addEventListener('change', () => { customExpireField.classList.toggle('show', expireTypeSelect.value === 'custom'); });

    form.addEventListener('submit', async (e) => { e.preventDefault(); await createShortLink(); });

    async function createShortLink() {
      const url = document.getElementById('url').value.trim();
      const slug = document.getElementById('slug').value.trim() || undefined;
      const password = passwordCheckbox.checked ? document.getElementById('password').value : undefined;
      const expireType = document.getElementById('expireType').value;
      const customMinutes = expireType === 'custom' ? parseInt(document.getElementById('customMinutes').value) : 0;

      if (!url) { showAlert('è¯·è¾“å…¥ç›®æ ‡ URL', 'error'); return; }
      if (password && password.length < 4) { showAlert('å¯†ç è‡³å°‘éœ€è¦ 4 ä¸ªå­—ç¬¦', 'error'); return; }
      if (expireType === 'custom' && (!customMinutes || customMinutes < 1)) { showAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„è‡ªå®šä¹‰è¿‡æœŸæ—¶é—´', 'error'); return; }

      showLoading(true); resultModal.classList.remove('show');
      try {
        const payload = { url, ...(slug && { slug }), ...(password && { password }), expireType, ...(expireType === 'custom' && { customMinutes }) };
        const response = await fetch('/create', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        const data = await response.json();
        if (response.ok) { showAlert('âœ… çŸ­é“¾ç”ŸæˆæˆåŠŸï¼', 'success'); displayResult(data); } 
        else { showAlert(data.message || 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•', 'error'); }
      } catch (error) { showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error'); } finally { showLoading(false); }
    }

    function displayResult(data) {
      document.getElementById('resultLink').textContent = data.link;
      document.getElementById('resultSlug').textContent = data.slug;
      document.getElementById('resultPassword').textContent = data.isPasswordProtected ? 'âœ… å·²ä¿æŠ¤' : 'âŒ æ— ä¿æŠ¤';
      document.getElementById('resultExpire').textContent = data.expireTime || 'æ°¸ä¸è¿‡æœŸ';
      resultModal.classList.add('show');
    }

    function showAlert(message, type) {
      alertDiv.textContent = message; alertDiv.className = `alert show ${type}`; setTimeout(() => alertDiv.classList.remove('show'), 3000);
    }

    function showLoading(show) {
      const loading = document.getElementById('loading'); const submitText = document.getElementById('submitText');
      if (show) { loading.style.display = 'inline'; submitText.style.display = 'none'; } else { loading.style.display = 'none'; submitText.style.display = 'inline'; }
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        const btn = event.target; const original = btn.textContent;
        btn.textContent = 'âœ… å·²å¤åˆ¶!'; btn.classList.add('copied');
        setTimeout(() => { btn.textContent = original; btn.classList.remove('copied'); }, 2000);
      });
    }

    resultModal.addEventListener('click', function(e) { if (e.target === resultModal) resultModal.classList.remove('show'); });
  </script>
</body>
</html>
