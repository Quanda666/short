<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çŸ­é“¾ç”Ÿæˆå™¨</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
    .container { max-width: 600px; margin: 0 auto; }
    h1 { text-align: center; color: white; margin-bottom: 2rem; font-size: 2.5rem; }
    .form-group { margin-bottom: 1.5rem; }
    label { display: block; margin-bottom: 0.5rem; color: white; font-weight: 500; }
    input, select { width: 100%; padding: 0.75rem; border: none; border-radius: 8px; font-size: 1rem; }
    .hidden-field { display: none; }
    .hidden-field.show { display: block; }
    #shortenerForm { background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
    .checkbox-group { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; }
    .checkbox-group input[type="checkbox"] { width: auto; }
    button { width: 100%; padding: 1rem; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: background 0.3s; }
    button:hover { background: #5a67d8; }
    button:disabled { background: #a0aec0; cursor: not-allowed; }
    .loading { display: none; margin-right: 0.5rem; }
    .alert { position: fixed; top: 2rem; right: 2rem; padding: 1rem 1.5rem; border-radius: 8px; color: white; font-weight: 500; transform: translateX(400px); transition: transform 0.3s; z-index: 1000; }
    .alert.show { transform: translateX(0); }
    .alert.success { background: #48bb78; }
    .alert.error { background: #f56565; }
    .result-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; z-index: 2000; align-items: center; justify-content: center; }
    .result-modal.show { display: flex; }
    .result-modal > div { background: white; padding: 2.5rem; border-radius: 20px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.25); }
    .result-row { display: flex; justify-content: space-between; padding: 1rem 0; border-bottom: 1px solid #eee; }
    .result-row:last-child { border-bottom: none; }
    .result-label { font-weight: 500; color: #666; }
    .result-value { font-family: monospace; color: #333; word-break: break-all; }
    .copy-btn { background: #48bb78; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-top: 1rem; width: 100%; }
    .copy-btn:hover { background: #38a169; }
    .copy-btn.copied { background: #2f855a; }
    @media (max-width: 768px) { body { padding: 1rem; } h1 { font-size: 2rem; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”— çŸ­é“¾ç”Ÿæˆå™¨</h1>
    <form id="shortenerForm">
      <div class="form-group">
        <label for="url"style="color: black !important;"> ç›®æ ‡ URL</label>
        <input type="url" id="url" placeholder="https://example.com" required>
      </div>
      <div class="form-group">
        <label for="slug" style="color: black !important;">è‡ªå®šä¹‰çŸ­é“¾æ ‡è¯†</label>
        <input type="text" id="slug" placeholder="abcd(2-10ä½å­—ç¬¦)" maxlength="10">
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="enablePassword">
        <label for="enablePassword" style="margin:0; color:#333; font-weight:normal;">ğŸ”’ å¯†ç ä¿æŠ¤</label>
      </div>
      <div id="passwordField" class="form-group hidden-field">
        <label for="password">å¯†ç  (è‡³å°‘4ä½)</label>
        <input type="password" id="password" placeholder="è¾“å…¥å¯†ç ">
      </div>
      <div class="form-group">
        <label for="expireType">â° è¿‡æœŸæ—¶é—´</label>
        <select id="expireType">
          <option value="never">æ°¸ä¸è¿‡æœŸ</option>
          <option value="hour">1å°æ—¶</option>
          <option value="day">1å¤©</option>
          <option value="week">1å‘¨</option>
          <option value="month">1ä¸ªæœˆ</option>
          <option value="custom">è‡ªå®šä¹‰æ—¶é—´</option>
        </select>
      </div>
      <div id="customExpireField" class="form-group hidden-field">
        <label for="customMinutes">è‡ªå®šä¹‰åˆ†é’Ÿæ•°</label>
        <input type="number" id="customMinutes" placeholder="60åˆ†é’Ÿ" min="1">
      </div>
      <button type="submit">
        <span class="loading" id="loading">â³ ç”Ÿæˆä¸­...</span>
        <span id="submitText">ğŸš€ ç”ŸæˆçŸ­é“¾</span>
      </button>
    </form>
    <div id="alert" class="alert"></div>
  </div>

  <div class="result-modal" id="resultModal">
    <div>
      <div class="result-row">
        <span class="result-label">çŸ­é“¾æ¥</span>
        <span class="result-value" id="resultLink">-</span>
      </div>
      <div class="result-row">
        <span class="result-label">çŸ­é“¾æ ‡è¯†</span>
        <span class="result-value" id="resultSlug">-</span>
      </div>
      <div class="result-row">
        <span class="result-label">å¯†ç ä¿æŠ¤</span>
        <span class="result-value" id="resultPassword">-</span>
      </div>
      <div class="result-row">
        <span class="result-label">è¿‡æœŸæ—¶é—´ (ä¸­å›½æ—¶é—´)</span>
        <span class="result-value" id="resultExpire">-</span>
      </div>
      <button class="copy-btn" onclick="copyToClipboard(document.getElementById('resultLink').textContent)">ğŸ“‹ å¤åˆ¶çŸ­é“¾æ¥</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('shortenerForm');
    const passwordCheckbox = document.getElementById('enablePassword');
    const passwordField = document.getElementById('passwordField');
    const expireTypeSelect = document.getElementById('expireType');
    const customExpireField = document.getElementById('customExpireField');
    const alertDiv = document.getElementById('alert');
    const resultModal = document.getElementById('resultModal');

    passwordCheckbox.addEventListener('change', () => { passwordField.classList.toggle('show', passwordCheckbox.checked); });
    expireTypeSelect.addEventListener('change', () => { customExpireField.classList.toggle('show', expireTypeSelect.value === 'custom'); });

    form.addEventListener('submit', async (e) => { e.preventDefault(); await createShortLink(); });

    async function createShortLink() {
      const url = document.getElementById('url').value.trim();
      const slug = document.getElementById('slug').value.trim() || undefined;
      const password = passwordCheckbox.checked ? document.getElementById('password').value : undefined;
      const expireType = document.getElementById('expireType').value;
      const customMinutes = expireType === 'custom' ? parseInt(document.getElementById('customMinutes').value) : 0;

      if (!url) { showAlert('è¯·è¾“å…¥ç›®æ ‡ URL', 'error'); return; }
      if (password && password.length < 4) { showAlert('å¯†ç è‡³å°‘éœ€è¦ 4 ä¸ªå­—ç¬¦', 'error'); return; }
      if (expireType === 'custom' && (!customMinutes || customMinutes < 1)) { showAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„è‡ªå®šä¹‰è¿‡æœŸæ—¶é—´', 'error'); return; }

      showLoading(true); resultModal.classList.remove('show');
      try {
        const payload = { url, ...(slug && { slug }), ...(password && { password }), expireType, ...(expireType === 'custom' && { customMinutes }) };
        const response = await fetch('/create', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        const data = await response.json();
        if (response.ok) { showAlert('âœ… çŸ­é“¾ç”ŸæˆæˆåŠŸï¼', 'success'); displayResult(data); } 
        else { showAlert(data.message || 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•', 'error'); }
      } catch (error) { showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error'); } finally { showLoading(false); }
    }

    function displayResult(data) {
      document.getElementById('resultLink').textContent = data.link;
      document.getElementById('resultSlug').textContent = data.slug;
      document.getElementById('resultPassword').textContent = data.isPasswordProtected ? 'âœ… å·²ä¿æŠ¤' : 'âŒ æ— ä¿æŠ¤';
      document.getElementById('resultExpire').textContent = data.expireTime || 'æ°¸ä¸è¿‡æœŸ';
      resultModal.classList.add('show');
    }

    function showAlert(message, type) {
      alertDiv.textContent = message; alertDiv.className = `alert show ${type}`; setTimeout(() => alertDiv.classList.remove('show'), 3000);
    }

    function showLoading(show) {
      const loading = document.getElementById('loading'); const submitText = document.getElementById('submitText');
      if (show) { loading.style.display = 'inline'; submitText.style.display = 'none'; } else { loading.style.display = 'none'; submitText.style.display = 'inline'; }
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        const btn = event.target; const original = btn.textContent;
        btn.textContent = 'âœ… å·²å¤åˆ¶!'; btn.classList.add('copied');
        setTimeout(() => { btn.textContent = original; btn.classList.remove('copied'); }, 2000);
      });
    }

    resultModal.addEventListener('click', function(e) { if (e.target === resultModal) resultModal.classList.remove('show'); });
  </script>
</body>
</html>
